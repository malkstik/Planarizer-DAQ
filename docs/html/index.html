<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Planarizer DAQ: Planarizer DAQ Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Planarizer DAQ
   </div>
   <div id="projectbrief">This DAQ was made to be used with the Planarizer Senior Project for the Cal Poly Legged Robot Team</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Planarizer DAQ Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p >Our Senior Project Group, consisting of Aaron Tran, Eric Ramos, Matthew Wimberley, and Tim Jain, was tasked with designing and manufacturing a test stand for the Cal Poly Legged Robot Team. The team needed a way to constrain a single robot leg to 2DOF in the sagittal plane. Hence, our test stand "planarizes" the robot leg. With the additional need of requiring that the robot leg be able to reach a steady state gait, we determined that a boom system would work best, though it only approximates the sagittal plane. This DAQ is responsible for measuring the corresponding rotational value of the Planarizer, allowing for us to track the position of the robot leg during testing.</p>
<p >The DAQ consists of two STM32L476RG Nucleos, synchronized using two HiLetgo HC-05 bluetooth transceivers. The DAQ makes use of two US Digital E6 Optical Kit Encoders to measure the yaw and pitch of the encoders. These values are then processed, plotted, and saved in MATLAB. This code is currently able to collect data at 60Hz. <br  />
For more information, refer to the following links <br  />
</p><ul>
<li>GitHub: <a href="https://github.com/malkstik/Planarizer-DAQ">https://github.com/malkstik/Planarizer-DAQ</a></li>
<li>Senior Project Report: <br  />
</li>
</ul>
<h1><a class="anchor" id="yaw_task_dia"></a>
Task Diagram</h1>
<div class="image">
<img src="PlanarizerTD.PNG" alt=""/>
</div>
<h1><a class="anchor" id="st_dia"></a>
State Transition Diagram</h1>
<p >While each task can be considered to be running as its own finite state machine, each is synchronized to be in the same overall state. Accordingly, one state transition diagram is adequate to describe each task.</p>
<div class="image">
<img src="PlanarizerSTD.PNG" alt=""/>
</div>
<h1><a class="anchor" id="improvementSW"></a>
Areas For Improvement in Software</h1>
<p >The initial target for the data polling rate was 200Hz. However, due to time constraints we left it at 60Hz. Some notable issues limiting the polling rate include the speed of vanilla FreeRTOS and the level of corruption in the data sent over bluetooth. The amount of corruption is a function of how quickly we are reading and writing data, and we are operating near the limits of vanilla FreeRTOS. While the hardware and EncoderDriver are certainly able to handle 200Hz, we can not send the data quickly enough.</p>
<p >Some solutions we believe may work include working in the STM32CubeMX environment, moving away from FreeRTOS, and reconfiguring FreeRTOS.</p>
<p >Using STM32CubeMX gives the user greater access to manipulating the Nucleo's hardware. The code can then be made more specific to using the Nucleo, and make better use of the on board hardware. This should result in significant speed increases, though the environment can be a little tricky to work with.</p>
<p >This code was built with FreeRTOS to allow for greater modularity. If this is unnecessary, and we need more speed, FreeRTOS may not be the best route.</p>
<p >This code uses vanilla FreeRTOS. However, FreeRTOS can be forked from <a href="https://github.com/stm32duino/STM32FreeRTOS.git">https://github.com/stm32duino/STM32FreeRTOS.git</a> to be modified and sped up.</p>
<p ><b> <em> If the current code is modified, then ensure that the correct code is uploaded to the correct microcontrollers. The environment can be chosen in the bar available at the bottom if PlatformIO is open. Make sure YAW gets uploaded to the Yaw MCU and that PITCH gets uploaded to the Pitch MCU. The two can be differentiated by whether or not SB1 has been shorted or not. Additionally, to upload anything to the Pitch MCU, move the jumper on JP5 such that it connects pins 2 and 3. Return it such that it connects pins 1 and 2 once the upload is complete. JP5 chooses if the MCU receives power from the usb port or from the E5V pin. </em> </b></p>
<h1><a class="anchor" id="improvementHW"></a>
Areas For Improvement in Hardware</h1>
<p >In terms of hardware, the Arduino Shield is functional but does not have the best form factor. Additionally, the solution to maintaining a high enough load on the power bank to keep it from powering off when the Nucleo goes to sleep is power inefficient.</p>
<p >The Arduino Shield is a solder breadboard, and is accordingly much larger than it needs to be. Creating a custom PCB may be desirable to reduce the overall form factor.It may also reduce concerns of breaking the bluetooth module, as the breakout board used sticks out a lot.</p>
<p >Powerbanks automatically stop supplying power when they do not detect high enough loads, and Nucleos go to sleep periodically, dropping their load to zero. To work around this five 100 ohm resistors, rated for 1/4 W, have been attached in parallel to draw out 250mA. This is far more than necessary and results in significant heat dissipation. This brings up concern over injury, though minor, from touching the resistors. Luckily, the power bank we use has more than enough capacity to run for a couple hours during testing, so if the hot resistors are acceptable then no change is necessary. However, if desired, a different circuit may be used that periodically draws power to keep the powerbank "awake." A quick internet search will yield examples of such circuits. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
