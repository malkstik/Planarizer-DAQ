\hypertarget{class_share}{}\doxysection{Share\texorpdfstring{$<$}{<} Data\+Type \texorpdfstring{$>$}{>} Class Template Reference}
\label{class_share}\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}}


Class for data to be shared in a thread-\/safe manner between tasks.  




{\ttfamily \#include $<$taskshare.\+h$>$}

Inheritance diagram for Share\texorpdfstring{$<$}{<} Data\+Type \texorpdfstring{$>$}{>}\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_share}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_share_a0948b04d00aef072f25af2f49ecfa259}{Share}} (const char $\ast$p\+\_\+name=NULL)
\begin{DoxyCompactList}\small\item\em Construct a shared data item. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_share_aef08e3bc0686d8032f40613be8c13df4}{put}} (Data\+Type new\+\_\+data)
\begin{DoxyCompactList}\small\item\em Put data into the shared data item. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_share_a2f14732a5337d8d54e36de7c8bfc6459}{ISR\+\_\+put}} (Data\+Type new\+\_\+data)
\begin{DoxyCompactList}\small\item\em Put data into the shared data item from within an ISR. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_share_ab4990baa4c1ea5572618520c5a3b39e7}{operator$<$$<$}} (Data\+Type new\+\_\+data)
\begin{DoxyCompactList}\small\item\em Operator which inserts data into the share. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_share_a38fb597f730afaf9fac97240b0286f55}{operator$>$$>$}} (Data\+Type put\+\_\+here)
\begin{DoxyCompactList}\small\item\em Read data from the shared data item. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_share_a979bfb3c7bf8aa5f0601a649553d516c}{get}} (Data\+Type \&recv\+\_\+data)
\begin{DoxyCompactList}\small\item\em Read data from the shared data item into a variable. \end{DoxyCompactList}\item 
Data\+Type \mbox{\hyperlink{class_share_ac544379dc98c1d1424efca1083baef7d}{get}} (void)
\begin{DoxyCompactList}\small\item\em Read and return data from the shared data item. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_share_a6f69eaea2dd026247dd6772a1aea23c4}{ISR\+\_\+get}} (Data\+Type \&recv\+\_\+data)
\begin{DoxyCompactList}\small\item\em Read data from the shared data item, from within an ISR. \end{DoxyCompactList}\item 
Data\+Type \mbox{\hyperlink{class_share_a8c77e37949f1e231c2c0e5b387eb3ee0}{ISR\+\_\+get}} (void)
\begin{DoxyCompactList}\small\item\em Read and return data from the shared data item, from within an ISR. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_share_afbda236ee6fe392200a766d7e4e8a080}{print\+\_\+in\+\_\+list}} (Print \&printer)
\begin{DoxyCompactList}\small\item\em Print the name and type (share) of this data item. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_share_a1b82b2d5fa5e69b0445fb5a718a9575a}\label{class_share_a1b82b2d5fa5e69b0445fb5a718a9575a}} 
Queue\+Handle\+\_\+t {\bfseries queue}
\begin{DoxyCompactList}\small\item\em A queue is used to hold the data, as it\textquotesingle{}s portable to different CPU\textquotesingle{}s. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
\subsubsection*{template$<$class Data\+Type$>$\newline
class Share$<$ Data\+Type $>$}
Class for data to be shared in a thread-\/safe manner between tasks. 

This class implements an item of data which can be shared between tasks without the risk of data corruption associated with global variables. Unlike queues, shares do not use a buffer for many data items; there is only a one-\/item buffer in which the most recent value of the data is kept. Shares therefore do not provide the task synchronization or incur the overhead associated with queues.

The data is protected by using critical code sections (see the Free\+RTOS documentation of {\ttfamily port\+ENTER\+\_\+\+CRITICAL()} ) so that tasks can\textquotesingle{}t interrupt each other when reading or writing the data is taking place. This prevents data corruption due to thread switching. The C++ template mechanism is used to ensure that only data of the correct type is put into or taken from a shared data item. A {\ttfamily Task\+Share$<$\+Data\+Type$>$} object keeps its own separate copy of the data. This uses some memory, but it is necessary to reliably prevent data corruption; it prevents possible side effects from causing the sender\textquotesingle{}s copy of the data from being inadvertently changed.\hypertarget{class_share_usage_share}{}\doxysubsection{Usage}\label{class_share_usage_share}
The following bits of code show how to set up and use a share to transfer data of type {\ttfamily uint16\+\_\+t} from one hypothetical task called {\ttfamily task\+\_\+A} to another called {\ttfamily task\+\_\+B}.

In the file which contains {\ttfamily setup()} we create a shared data object. The constructor of the {\ttfamily Share$<$uint16\+\_\+t$>$} class is given a name for the share; the name will be shown on system diagnostic printouts. If it is desired to print diagnostic information to a serial monitor, a pointer to an output stream may also be given\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{taskshare_8h}{taskshare.h}}"{}}}
\DoxyCodeLine{...}
\DoxyCodeLine{Share<uint16\_t> my\_share (\textcolor{stringliteral}{"{}Data\_3"{}}, \&Serial);}

\end{DoxyCode}
 If there are any tasks which use this share in other source files, we must re-\/declare this share with the keyword {\ttfamily extern} near the top of those files to make it accessible to those task(s). This copy of the share does not need a Doxygen comment\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Sensor 3 (right antler) data}}
\DoxyCodeLine{\textcolor{keyword}{extern} \mbox{\hyperlink{class_share}{Share<uint16\_t>}} my\_share;}

\end{DoxyCode}
 In the sending task, data is put into the share\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{uint16\_t a\_data\_item = 42;     }
\DoxyCodeLine{...}
\DoxyCodeLine{a\_data\_item = antler3 ();      \textcolor{comment}{// Get the data}}
\DoxyCodeLine{my\_share.\mbox{\hyperlink{class_share_aef08e3bc0686d8032f40613be8c13df4}{put}} (a\_data\_item);    \textcolor{comment}{// Put data into share}}

\end{DoxyCode}
 In the receiving task, data is read from the share\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{uint16\_t got\_data;             }
\DoxyCodeLine{...}
\DoxyCodeLine{my\_share.get (got\_data);       \textcolor{comment}{// Get local copy of shared data}}

\end{DoxyCode}


{\bfseries{The}} {\bfseries{Easy}} {\bfseries{Way}} It\textquotesingle{}s also possible to use overloaded stream insertion and extraction operators to interact with the share. These operators contain code which checks if they\textquotesingle{}re running in an interrupt service routine (ISR) or not and use the appropriate method to interact with the internal queue which holds the data, so they\textquotesingle{}re a little slower than {\ttfamily \mbox{\hyperlink{class_share_aef08e3bc0686d8032f40613be8c13df4}{put()}}} and {\ttfamily \mbox{\hyperlink{class_share_ac544379dc98c1d1424efca1083baef7d}{get()}}}. Usage is as follows, assuming that the share and local variable have been set up above\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{my\_share << a\_data\_item;       \textcolor{comment}{// In sending task}}
\DoxyCodeLine{...}
\DoxyCodeLine{my\_share >> got\_data;          \textcolor{comment}{// In receiving task}}

\end{DoxyCode}
 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_share_a0948b04d00aef072f25af2f49ecfa259}\label{class_share_a0948b04d00aef072f25af2f49ecfa259}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!Share@{Share}}
\index{Share@{Share}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{Share()}{Share()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
\mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::\mbox{\hyperlink{class_share}{Share}} (\begin{DoxyParamCaption}\item[{const char $\ast$}]{p\+\_\+name = {\ttfamily NULL} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Construct a shared data item. 

This constructor for a shared data item creates a queue in which to hold one item of data. Note that the data is {\bfseries{not}} initialized. 
\begin{DoxyParams}{Parameters}
{\em p\+\_\+name} & A name to be shown in the list of task shares (default {\ttfamily NULL}) \\
\hline
\end{DoxyParams}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_share_a979bfb3c7bf8aa5f0601a649553d516c}\label{class_share_a979bfb3c7bf8aa5f0601a649553d516c}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!get@{get}}
\index{get@{get}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{get()}{get()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::get (\begin{DoxyParamCaption}\item[{Data\+Type \&}]{recv\+\_\+data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Read data from the shared data item into a variable. 

This method is used to read data from the shared data item with protection to ensure that the data cannot be corrupted by a task switch. The shared data is copied into the variable which is given as this method\textquotesingle{}s parameter, replacing the previous contents of that variable. 
\begin{DoxyParams}{Parameters}
{\em recv\+\_\+data} & A reference to the variable in which to put received data \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{class_share_ac544379dc98c1d1424efca1083baef7d}\label{class_share_ac544379dc98c1d1424efca1083baef7d}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!get@{get}}
\index{get@{get}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{get()}{get()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
Data\+Type \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::get (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Read and return data from the shared data item. 

This method is used to read data from the shared data item with protection to ensure that the data cannot be corrupted by a task switch. A copy of the shared data is returned. \begin{DoxyReturn}{Returns}
A copy of the data found in the queue, or a default value of the given data type if no data was found in the queue 
\end{DoxyReturn}
\mbox{\Hypertarget{class_share_a6f69eaea2dd026247dd6772a1aea23c4}\label{class_share_a6f69eaea2dd026247dd6772a1aea23c4}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!ISR\_get@{ISR\_get}}
\index{ISR\_get@{ISR\_get}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{ISR\_get()}{ISR\_get()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::ISR\+\_\+get (\begin{DoxyParamCaption}\item[{Data\+Type \&}]{recv\+\_\+data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Read data from the shared data item, from within an ISR. 

This method is used to enable code within an ISR to read data from the shared data item. It must only be called from within an interrupt service routine, not a normal task. 
\begin{DoxyParams}{Parameters}
{\em recv\+\_\+data} & A reference to the variable in which to put received data \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{class_share_a8c77e37949f1e231c2c0e5b387eb3ee0}\label{class_share_a8c77e37949f1e231c2c0e5b387eb3ee0}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!ISR\_get@{ISR\_get}}
\index{ISR\_get@{ISR\_get}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{ISR\_get()}{ISR\_get()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
Data\+Type \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::ISR\+\_\+get (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Read and return data from the shared data item, from within an ISR. 

This method is used to enable code within an ISR to read data from the shared data item. It must only be called from within an interrupt service routine, not a normal task. \begin{DoxyReturn}{Returns}
A copy of the data found in the queue, or a default value of the given data type if no data was found in the queue 
\end{DoxyReturn}
\mbox{\Hypertarget{class_share_a2f14732a5337d8d54e36de7c8bfc6459}\label{class_share_a2f14732a5337d8d54e36de7c8bfc6459}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!ISR\_put@{ISR\_put}}
\index{ISR\_put@{ISR\_put}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{ISR\_put()}{ISR\_put()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::ISR\+\_\+put (\begin{DoxyParamCaption}\item[{Data\+Type}]{new\+\_\+data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Put data into the shared data item from within an ISR. 

This method writes data from an ISR into the shared data item. It must only be called from within an interrupt service routine, not a normal task. 
\begin{DoxyParams}{Parameters}
{\em new\+\_\+data} & The data to be written into the shared data item \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{class_share_ab4990baa4c1ea5572618520c5a3b39e7}\label{class_share_ab4990baa4c1ea5572618520c5a3b39e7}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!operator$<$$<$@{operator$<$$<$}}
\index{operator$<$$<$@{operator$<$$<$}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{operator$<$$<$()}{operator<<()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::operator$<$$<$ (\begin{DoxyParamCaption}\item[{Data\+Type}]{new\+\_\+data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Operator which inserts data into the share. 

This convenient operator puts data into the share, protecting the data from corruption by thread switching. It checks if the processor is currently in an interupt service routine (ISR); if so, it calls ISR specific functions to prevent corruption, so this function may be used within an ISR or outside one. It runs a little more slowly than the {\ttfamily \mbox{\hyperlink{class_share_aef08e3bc0686d8032f40613be8c13df4}{put()}}} method. 
\begin{DoxyParams}{Parameters}
{\em new\+\_\+data} & The data which is to be put into the share \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{class_share_a38fb597f730afaf9fac97240b0286f55}\label{class_share_a38fb597f730afaf9fac97240b0286f55}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!operator$>$$>$@{operator$>$$>$}}
\index{operator$>$$>$@{operator$>$$>$}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{operator$>$$>$()}{operator>>()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::operator$>$$>$ (\begin{DoxyParamCaption}\item[{Data\+Type}]{put\+\_\+here }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Read data from the shared data item. 

This method is used to read data from the shared data item with critical section protection to ensure that the data cannot be corrupted by a task switch. The shared data is copied into the variable which is given as this method\textquotesingle{}s parameter, replacing the previous contents. This method checks if the processor is currently in an interupt service routine (ISR) and if so, it calls ISR specific functions to prevent corruption, so this function may be used within an ISR or outside one. It runs a little more slowly than the {\ttfamily \mbox{\hyperlink{class_share_ac544379dc98c1d1424efca1083baef7d}{get()}}} method because of the run-\/time ISR check. 
\begin{DoxyParams}{Parameters}
{\em put\+\_\+here} & A reference to the variable in which to put received data \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{class_share_afbda236ee6fe392200a766d7e4e8a080}\label{class_share_afbda236ee6fe392200a766d7e4e8a080}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!print\_in\_list@{print\_in\_list}}
\index{print\_in\_list@{print\_in\_list}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{print\_in\_list()}{print\_in\_list()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::print\+\_\+in\+\_\+list (\begin{DoxyParamCaption}\item[{Print \&}]{printer }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Print the name and type (share) of this data item. 

This method prints the share\textquotesingle{}s name and a word indicating that it is a shared data item, as opposed to a queue, formatted to match similar printouts from other task shares such as queues. After printing this share\textquotesingle{}s information, it looks in the linked list of shares for the next one and asks it to print its information too. 
\begin{DoxyParams}{Parameters}
{\em printer} & Reference to a serial device on which to print the status \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{class_base_share_a6f72027a717afada4679fd08d08bb4b6}{Base\+Share}}.

\mbox{\Hypertarget{class_share_aef08e3bc0686d8032f40613be8c13df4}\label{class_share_aef08e3bc0686d8032f40613be8c13df4}} 
\index{Share$<$ DataType $>$@{Share$<$ DataType $>$}!put@{put}}
\index{put@{put}!Share$<$ DataType $>$@{Share$<$ DataType $>$}}
\doxysubsubsection{\texorpdfstring{put()}{put()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_share}{Share}}$<$ Data\+Type $>$\+::put (\begin{DoxyParamCaption}\item[{Data\+Type}]{new\+\_\+data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Put data into the shared data item. 

This method is used to write data into the shared data item. 
\begin{DoxyParams}{Parameters}
{\em new\+\_\+data} & The data which is to be written \\
\hline
\end{DoxyParams}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
src/\mbox{\hyperlink{taskshare_8h}{taskshare.\+h}}\end{DoxyCompactItemize}
